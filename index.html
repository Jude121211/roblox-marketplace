<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roblox Marketplace</title>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
* { box-sizing: border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background: linear-gradient(135deg,#1a0a2b,#4b1e70); color:#fff; min-height:100vh; display:flex; justify-content:center; align-items:center; }
.container { width:500px; background:rgba(0,0,0,0.85); border-radius:15px; overflow:hidden; box-shadow:0 0 25px rgba(75,30,130,0.7); animation:fadeIn 1s ease forwards; }
@keyframes fadeIn { from{opacity:0; transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }
.tabs { display:flex; cursor:pointer; background: rgba(75,30,130,0.9); }
.tab { flex:1; text-align:center; padding:15px; transition:background 0.3s; }
.tab.active { background: linear-gradient(135deg,#8e2de2,#4a00e0); }
.tab-content { padding:20px; display:none; animation:fadeSlide 0.5s ease forwards; }
.tab-content.active { display:block; }
@keyframes fadeSlide { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
input,textarea,button,select { width:100%; padding:10px; margin:10px 0; border-radius:8px; border:none; outline:none; font-size:14px; }
input,textarea,select { background:rgba(255,255,255,0.1); color:#fff; }
input::placeholder, textarea::placeholder { color:#ccc; }
button { background: linear-gradient(135deg,#8e2de2,#4a00e0); color:#fff; font-weight:bold; cursor:pointer; transition:transform 0.2s, box-shadow 0.2s; }
button:hover { transform:translateY(-2px); box-shadow:0 5px 15px rgba(75,30,130,0.6); }
.account-list { margin-top:10px; max-height:300px; overflow-y:auto; }
.account-item { background: rgba(75,30,130,0.5); padding:10px; margin-bottom:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; transition: transform 0.2s; }
.account-item:hover { transform:scale(1.02); }
.account-info { display:flex; flex-direction:column; }
.header-buttons { display:flex; justify-content:flex-end; gap:10px; padding:10px; background: rgba(75,30,130,0.7); }
.header-buttons button { width:auto; padding:5px 10px; font-size:13px; }
.cart-list { max-height:150px; overflow-y:auto; margin-top:10px; background: rgba(75,30,130,0.3); padding:10px; border-radius:8px; }
.cart-item { display:flex; justify-content:space-between; padding:5px 0; }
/* Modal */
.modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center; display:none; }
.modal-content { background: rgba(50,0,80,0.95); padding:20px; border-radius:12px; width:350px; text-align:center; position:relative; }
.close-btn { position:absolute; top:10px; right:10px; cursor:pointer; font-size:20px; font-weight:bold; color:#fff; }
.modal-content p { margin:10px 0; word-break:break-all; }
</style>
</head>
<body>

<div class="container">
  <div class="header-buttons">
      <button id="notificationsBtn">ðŸ”” Notifications (<span id="notifCount">0</span>)</button>
      <button id="cartBtn">ðŸ›’ Cart (<span id="cartCount">0</span>)</button>
  </div>

  <div class="tabs">
      <div class="tab active" data-tab="add">Add Listing</div>
      <div class="tab" data-tab="list">Marketplace</div>
  </div>

  <div class="tab-content active" id="add">
      <input type="text" id="username" placeholder="Username">
      <input type="number" id="currency" placeholder="Currency Amount">
      <textarea id="description" placeholder="Details about the account"></textarea>
      <button id="addAccount">Add Listing</button>
  </div>

  <div class="tab-content" id="list">
      <div class="account-list" id="marketplaceGrid"></div>
  </div>
</div>

<!-- Cart Modal -->
<div class="modal" id="cartModal">
  <div class="modal-content">
      <span class="close-btn" id="closeCart">&times;</span>
      <h2>Cart</h2>
      <div class="cart-list" id="cartList"></div>
  </div>
</div>

<!-- Notifications Modal -->
<div class="modal" id="notifModal">
  <div class="modal-content">
      <span class="close-btn" id="closeNotif">&times;</span>
      <h2>Notifications</h2>
      <div id="notifList"></div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDeky6vodmrC1neoxCrigEGGLvxcu81WPw",
  authDomain: "roblox-marketplace-fc59b.firebaseapp.com",
  projectId: "roblox-marketplace-fc59b",
  storageBucket: "roblox-marketplace-fc59b.firebasestorage.app",
  messagingSenderId: "1042562482941",
  appId: "1:1042562482941:web:a5a160ec9b6367444db494",
  measurementId: "G-QQ8XC8YVMK"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let cart = [];
let notifications = [];

// Tabs
const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => tab.addEventListener('click', () => {
  tabs.forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  tabContents.forEach(tc => tc.classList.remove('active'));
  document.getElementById(tab.dataset.tab).classList.add('active');
}));

// Add listing
document.getElementById("addAccount").addEventListener("click", () => {
  const username = document.getElementById("username").value.trim();
  const currency = document.getElementById("currency").value.trim();
  const description = document.getElementById("description").value.trim();

  if(!username || !currency){
    alert("Username and Currency are required!");
    return;
  }

  db.collection("listings").add({
    username,
    currency,
    description,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    notifications.push(`New listing added: ${username}`);
    updateNotifications();
    fetchListings();
    document.getElementById("username").value="";
    document.getElementById("currency").value="";
    document.getElementById("description").value="";
  });
});

// Fetch and render listings
function fetchListings(){
  db.collection("listings").orderBy("timestamp","desc").get().then(snapshot=>{
    const grid = document.getElementById("marketplaceGrid");
    grid.innerHTML="";
    snapshot.forEach(doc=>{
      const acc = doc.data();
      const card = document.createElement("div");
      card.className="account-item";
      card.innerHTML = `
        <div class="account-info">
          <strong>${acc.username}</strong>
          <span>${acc.description}</span>
          <span>Currency: ${acc.currency}</span>
        </div>
        <div>
          <button onclick="addToCart('${doc.id}')">Add to Cart</button>
        </div>
      `;
      grid.appendChild(card);
    });
  });
}

// Cart
const cartBtn = document.getElementById('cartBtn');
const cartModal = document.getElementById('cartModal');
const closeCart = document.getElementById('closeCart');
const cartList = document.getElementById('cartList');

function addToCart(id){
  if(cart.includes(id)) { alert("Already in cart"); return; }
  cart.push(id);
  updateCart();
  notifications.push("Added to cart!");
  updateNotifications();
}

function updateCart(){
  document.getElementById('cartCount').textContent = cart.length;
  cartList.innerHTML = "";
  cart.forEach(id=>{
    db.collection("listings").doc(id).get().then(doc=>{
      const data = doc.data();
      const item = document.createElement("div");
      item.className="cart-item";
      item.innerHTML=`<span>${data.username}</span><button onclick="buyFromCart('${id}')">Buy</button>`;
      cartList.appendChild(item);
    });
  });
}

function buyFromCart(id){
  db.collection("listings").doc(id).delete().then(()=>{
    cart = cart.filter(c=>c!==id);
    updateCart();
    fetchListings();
    notifications.push("Purchase completed!");
    updateNotifications();
  });
}

// Notifications
const notifBtn = document.getElementById('notificationsBtn');
const notifModal = document.getElementById('notifModal');
const closeNotif = document.getElementById('closeNotif');
const notifList = document.getElementById('notifList');

function updateNotifications(){
  document.getElementById('notifCount').textContent = notifications.length;
  notifList.innerHTML = notifications.map(n=>`<p>${n}</p>`).join('');
}

notifBtn.addEventListener('click',()=>{notifModal.style.display='flex';});
closeNotif.addEventListener('click',()=>{notifModal.style.display='none';});
window.addEventListener('click',(e)=>{if(e.target===notifModal) notifModal.style.display='none';});
cartBtn.addEventListener('click',()=>{cartModal.style.display='flex';});
closeCart.addEventListener('click',()=>{cartModal.style.display='none';});
window.addEventListener('click',(e)=>{if(e.target===cartModal) cartModal.style.display='none';});

// Load listings on page load
window.onload = fetchListings;
</script>
</body>
</html>
